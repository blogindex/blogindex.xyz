---
version: '3'
services:

  apidb:
    container_name: apidb
    image: postgres
    restart: always
    environment:
      - POSTGRES_USER=blogindex
      - POSTGRES_PASSWORD=blogindex
      - POSTGRES_DB=blogindex

  apitest:
    container_name: apitest
    build: .
    image: blogindex/api-test:latest
#    volumes:   ##OPTIONAL to run local codebase
#      - /docker/dev/blogindex.xyz/beardedtek:/blogindex.xyz
    depends_on:
     - apidb
    environment:
      - RUN_ON_CI=${RUN_ON_CI}
      - DATABASE_DB=${DATABASE_DB:-blogindex}
      - DATABASE_DB_HOST=${DATABASE_DB_HOST:-db}
      - DATABASE_DB_USER=${DATABASE_DB_USER:-blogindex}
      - DATABASE_DB_PASS=${DATABASE_DB_PASS:-blogindex}
      - BLOGINDEX_DEBUG=${BLOGINDEX_DEBUG:-True}
      - BLOGINDEX_LOG_LEVEL=${BLOGINDEX_LOG_LEVEL:-DEBUG}
      # These variables can be obtained by messaging @BeardedTek:matrix.org
      - AUTH0_DOMAIN=${AUTH0_DOMAIN}
      - AUTH0_API_AUDIENCE=${AUTH0_API_AUDIENCE}
      - AUTH0_ISSUER=${AUTH0_ISSUER}
      - AUTH0_ALGORITHMS=${AUTH0_ALGORITHMS}

      # You must provide eith TEST_KEY or CLIENT_ID and CLIENT_SECRET -- NOT BOTH!
      #- TEST_KEY=${TEST_KEY}
      - AUTH0_CLIENT_ID=${AUTH0_CLIENT_ID}
      - AUTH0_CLIENT_SECRET=${AUTH0_CLIENT_SECRET}
